"use strict";(self.webpackChunkiota_wiki=self.webpackChunkiota_wiki||[]).push([[254],{4325:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return c},default:function(){return p}});var r=n(3117),i=n(102),o=(n(7294),n(3905)),a=["components"],s={title:"Restore",description:"The join listener executes an action when a user joins your server."},l="Restore",u={unversionedId:"restore",id:"restore",title:"Restore",description:"The join listener executes an action when a user joins your server.",source:"@site/internal/automations/restore.md",sourceDirName:".",slug:"/restore",permalink:"/comfyai_docs_build/automations/restore",editUrl:"test/internal/automations/restore.md",tags:[],version:"current",lastUpdatedAt:1642629601,formattedLastUpdatedAt:"1/19/2022",frontMatter:{title:"Restore",description:"The join listener executes an action when a user joins your server."},sidebar:"build",previous:{title:"Join",permalink:"/comfyai_docs_build/automations/join"}},c=[{value:"Action expression",id:"action-expression",children:[],level:4},{value:"Possible arguments",id:"possible-arguments",children:[{value:"Options",id:"options",children:[{value:"Example",id:"example",children:[],level:4}],level:3}],level:2},{value:"Constraints",id:"constraints",children:[],level:2},{value:"Limitations",id:"limitations",children:[{value:"1. Data race mitigation",id:"1-data-race-mitigation",children:[],level:3},{value:"2. Rate limit mitigation",id:"2-rate-limit-mitigation",children:[],level:3}],level:2},{value:"Known issues",id:"known-issues",children:[{value:"1. Data race during degraded network conditions",id:"1-data-race-during-degraded-network-conditions",children:[],level:3}],level:2},{value:"Additional examples",id:"additional-examples",children:[],level:2}],d={toc:c};function p(e){var t=e.components,n=(0,i.Z)(e,a);return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"restore"},"Restore"),(0,o.kt)("h4",{id:"action-expression"},"Action expression"),(0,o.kt)("p",null,"The restore action restores a user's former member state."),(0,o.kt)("h2",{id:"possible-arguments"},"Possible arguments"),(0,o.kt)("h3",{id:"options"},"Options"),(0,o.kt)("p",null,"Controls which member properties will be restored to the member."),(0,o.kt)("p",null,"This argument takes a keyword value."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Keyword"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"nickname"),(0,o.kt)("td",{parentName:"tr",align:null},"Restores the member's nickname from the instant they left the server")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"roles"),(0,o.kt)("td",{parentName:"tr",align:null},"Restores the member's roles from the instant they left the server")))),(0,o.kt)("p",null,"By default, both are restored."),(0,o.kt)("h4",{id:"example"},"Example"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"when join state=rejoin -> restore options=nickname,roles")),(0,o.kt)("p",null,"This will trigger when a user rejoins the server after having already been inside it. It will restore the user's roles and nickname to their state when the user left the server."),(0,o.kt)("h2",{id:"constraints"},"Constraints"),(0,o.kt)("p",null,"Restore can only be used with the ",(0,o.kt)("inlineCode",{parentName:"p"},"join")," listener with a state of ",(0,o.kt)("inlineCode",{parentName:"p"},"rejoin"),"."),(0,o.kt)("h2",{id:"limitations"},"Limitations"),(0,o.kt)("p",null,"In an effort to give you a complete understanding of Comfy and the high level of reliability it offers, we provide full transparency of possible issues."),(0,o.kt)("h3",{id:"1-data-race-mitigation"},"1. Data race mitigation"),(0,o.kt)("p",null,"When a user joins your server, ComfyAI locks that user\u2019s memory table for three or less seconds. This means any external action (such as a different bot adding to a new users roles, or a manual role update) on a user\u2019s roles or nickname will not be noticed by Comfy. If this does happen Comfy's internal memory of that user will be out of date until the next time Comfy syncs data with Discord for that user."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Effect:")," If the user\u2019s memory table is out of sync actions will not run correctly until after the next sync."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Mitigation:")," Do not use other bots to manage user roles or nickname. If you must, ensure they don\u2019t manage them immediately when users join your server."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Why:")," Due to a limitation in Discord\u2019s API known as \u201ceventual consistency\u201d we have to use a complicated set of synchronization systems to ensure data sent and received from Discord is processed in the correct order. As a result we need to lock changes to users while those events fill into a queue to be executed upon. This isn\u2019t a flaw with Discord per se, it\u2019s what makes Discord so fast and reliable, but it does add challenges for bot developers."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Impact: LOW")),(0,o.kt)("h3",{id:"2-rate-limit-mitigation"},"2. Rate limit mitigation"),(0,o.kt)("p",null,"To respect Discord's infrastructure member data is only synced when:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"A users roles, nickname, handle, avatar are updated."),(0,o.kt)("li",{parentName:"ol"},"A user joins the server."),(0,o.kt)("li",{parentName:"ol"},"A user leaves the server.")),(0,o.kt)("p",null,"This will cause issues when ComfyAI joins an existing server, or when ComfyAI was removed from your server and later re-added. This is because Comfy has not continually synced data as actions happened, and is instead thrown into the mix with existing data."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Effect:")," Actions behaving strangely or not working."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Mitigation:")," Simply wait for ComfyAI to sync member data. We may in the future allow users to manually perform a serverwide sync, however this is very costly to Discord and us."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Impact: LOW")),(0,o.kt)("h2",{id:"known-issues"},"Known issues"),(0,o.kt)("h3",{id:"1-data-race-during-degraded-network-conditions"},"1. Data race during degraded network conditions"),(0,o.kt)("p",null,"In situations where network conditions are degraded between Discord and ComfyAI the restore action may not play correctly. We are researching how to solve this problem, but believe it currently will affect < 1 in a million joins."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Effect:")," Failure to restore roles."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Mitigation:")," None, will be fixed in the future."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Impact: LOW")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"additional-examples"},"Additional examples"),(0,o.kt)("p",null,"None"))}p.isMDXComponent=!0},3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),m=i,h=p["".concat(l,".").concat(m)]||p[m]||d[m]||o;return n?r.createElement(h,a(a({ref:t},c),{},{components:n})):r.createElement(h,a({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var u=2;u<o;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);