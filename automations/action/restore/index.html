<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons"><title data-react-helmet="true">Restore | ComfyAI Portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://cybermancy.org/comfyai_docs_build/automations/action/restore/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-automations-current"><meta data-react-helmet="true" property="og:title" content="Restore | ComfyAI Portal"><meta data-react-helmet="true" name="description" content="The join listener executes an action when a user joins your server."><meta data-react-helmet="true" property="og:description" content="The join listener executes an action when a user joins your server."><link data-react-helmet="true" rel="icon" href="/comfyai_docs_build/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cybermancy.org/comfyai_docs_build/automations/action/restore/"><link data-react-helmet="true" rel="alternate" href="https://cybermancy.org/comfyai_docs_build/automations/action/restore/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cybermancy.org/comfyai_docs_build/automations/action/restore/" hreflang="x-default"><link rel="stylesheet" href="/comfyai_docs_build/assets/css/styles.c13fbf78.css">
<link rel="preload" href="/comfyai_docs_build/assets/js/runtime~main.2914dafe.js" as="script">
<link rel="preload" href="/comfyai_docs_build/assets/js/main.be3323ff.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_1VR7"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/comfyai_docs_build/"><div class="navbar__logo"><img src="/comfyai_docs_build/img/logo.png" alt="ComfyAI Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/comfyai_docs_build/img/logo.png" alt="ComfyAI Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div></a><a class="navbar__item navbar__link" href="/comfyai_docs_build/guides/getting-started/inviting-the-bot/"><div class="link"><div class="link__body"><div class="link__label">Get Started</div></div></div></a><div class="dropdown dropdown--hoverable dropdown--mega"><a href="#" class="navbar__item navbar__link"><div class="link"><div class="link__body"><div class="link__label">Commands</div></div></div></a><div class="dropdown__container"><div class="dropdown__menu"><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Built-in Commands</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Custom Commands</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Data API</div></div><div class="col margin-horiz--xs dropdown__col"></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/comfyai_docs_build/guides/welcome/"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Basic Commands</div><div class="link__sublabel">Basic moderation</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/comfyai_docs_build/chrysalis-docs/welcome/"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Creating basic-commands</div><div class="link__sublabel">Create reusable actions</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/comfyai_docs_build/chrysalis-docs/welcome/"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">RESTful Discord API</div><div class="link__sublabel">Proxy discord to web</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/comfyai_docs_build/automations/what-are-when-commands/"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Automations</div><div class="link__sublabel">Respond to events</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/comfyai_docs_build/guides/imports_exports/"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Imports/exports</div><div class="link__sublabel">Move between servers</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div></div></div></div></div><a class="navbar__item navbar__link" href="/comfyai_docs_build/guides/welcome/"><div class="link"><div class="link__body"><div class="link__label">Guides</div></div></div></a><a href="#" class="navbar__item navbar__link"><div class="link"><div class="link__body"><div class="link__label">Tuning</div></div></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/comfyai_docs_build/pages/donate/"><div class="link"><div class="link__body"><div class="link__label">Donate</div></div></div></a><a class="navbar__item navbar__link" href="/comfyai_docs_build/releases/releases/"><div class="link"><div class="link__body"><div class="link__label">Releases</div></div></div></a><div class="navbar__item navbar__item--dock"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/comfyai_docs_build/"><img src="/comfyai_docs_build/img/logo.png" alt="ComfyAI Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/comfyai_docs_build/img/logo.png" alt="ComfyAI Logo" class="themedImage_1VuW themedImage--dark_hz6m"></a><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/comfyai_docs_build/automations/what-are-when-commands/">Introduction to automation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/comfyai_docs_build/automations/formatting/">The format of when commands</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/comfyai_docs_build/automations/what-is-a-snowflake/">Additional Reading</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/comfyai_docs_build/automations/listener/join/">Listeners</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/comfyai_docs_build/automations/action/restore/">Actions</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/comfyai_docs_build/automations/action/restore/">Restore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/comfyai_docs_build/automations/action/count/">Count</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Restore</h1></header><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="action-expression">Action expression<a class="hash-link" href="#action-expression" title="Direct link to heading">​</a></h4><p>The restore action restores a user&#x27;s former member state.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="possible-arguments">Possible arguments<a class="hash-link" href="#possible-arguments" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="options">Options<a class="hash-link" href="#options" title="Direct link to heading">​</a></h3><p>Controls which member properties will be restored to the member.</p><p>This argument takes a keyword value.</p><table><thead><tr><th>Keyword</th><th>Description</th></tr></thead><tbody><tr><td>nickname</td><td>Restores the member&#x27;s nickname from the instant they left the server</td></tr><tr><td>roles</td><td>Restores the member&#x27;s roles from the instant they left the server</td></tr></tbody></table><p>By default, both are restored.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="example">Example<a class="hash-link" href="#example" title="Direct link to heading">​</a></h4><p><code>when join state=rejoin -&gt; restore options=nickname,roles</code></p><p>This will trigger when a user rejoins the server after having already been inside it. It will restore the user&#x27;s roles and nickname to their state when the user left the server.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="constraints">Constraints<a class="hash-link" href="#constraints" title="Direct link to heading">​</a></h2><p>Restore can only be used with the <code>join</code> listener with a state of <code>rejoin</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="limitations">Limitations<a class="hash-link" href="#limitations" title="Direct link to heading">​</a></h2><p>In an effort to give you a complete understanding of Comfy and the high level of reliability it offers, we provide full transparency of possible issues.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="1-data-race-mitigation">1. Data race mitigation<a class="hash-link" href="#1-data-race-mitigation" title="Direct link to heading">​</a></h3><p>When a user joins your server, ComfyAI locks that user’s memory table for three or less seconds. This means any external action (such as a different bot adding to a new users roles, or a manual role update) on a user’s roles or nickname will not be noticed by Comfy. If this does happen Comfy&#x27;s internal memory of that user will be out of date until the next time Comfy syncs data with Discord for that user.</p><p><strong>Effect:</strong> If the user’s memory table is out of sync actions will not run correctly until after the next sync.</p><p><strong>Mitigation:</strong> Do not use other bots to manage user roles or nickname. If you must, ensure they don’t manage them immediately when users join your server.</p><p><strong>Why:</strong> Due to a limitation in Discord’s API known as “eventual consistency” we have to use a complicated set of synchronization systems to ensure data sent and received from Discord is processed in the correct order. As a result we need to lock changes to users while those events fill into a queue to be executed upon. This isn’t a flaw with Discord per se, it’s what makes Discord so fast and reliable, but it does add challenges for bot developers.</p><p><strong>Impact: LOW</strong></p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="2-rate-limit-mitigation">2. Rate limit mitigation<a class="hash-link" href="#2-rate-limit-mitigation" title="Direct link to heading">​</a></h3><p>To respect Discord&#x27;s infrastructure member data is only synced when:</p><ol><li>A users roles, nickname, handle, avatar are updated.</li><li>A user joins the server.</li><li>A user leaves the server.</li></ol><p>This will cause issues when ComfyAI joins an existing server, or when ComfyAI was removed from your server and later re-added. This is because Comfy has not continually synced data as actions happened, and is instead thrown into the mix with existing data.</p><p><strong>Effect:</strong> Actions behaving strangely or not working.</p><p><strong>Mitigation:</strong> Simply wait for ComfyAI to sync member data. We may in the future allow users to manually perform a serverwide sync, however this is very costly to Discord and us.</p><p><strong>Impact: LOW</strong></p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="known-issues">Known issues<a class="hash-link" href="#known-issues" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="1-data-race-during-degraded-network-conditions">1. Data race during degraded network conditions<a class="hash-link" href="#1-data-race-during-degraded-network-conditions" title="Direct link to heading">​</a></h3><p>In situations where network conditions are degraded between Discord and ComfyAI the restore action may not play correctly. We are researching how to solve this problem, but believe it currently will affect &lt; 1 in a million joins.</p><p><strong>Effect:</strong> Failure to restore roles.</p><p><strong>Mitigation:</strong> None, will be fixed in the future.</p><p><strong>Impact: LOW</strong></p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="additional-examples">Additional examples<a class="hash-link" href="#additional-examples" title="Direct link to heading">​</a></h2><p>None</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-01-22T02:07:28.000Z">1/21/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/comfyai_docs_build/automations/listener/counter/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Counter</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/comfyai_docs_build/automations/action/count/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Count</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#possible-arguments" class="table-of-contents__link toc-highlight">Possible arguments</a><ul><li><a href="#options" class="table-of-contents__link toc-highlight">Options</a></li></ul></li><li><a href="#constraints" class="table-of-contents__link toc-highlight">Constraints</a></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations</a><ul><li><a href="#1-data-race-mitigation" class="table-of-contents__link toc-highlight">1. Data race mitigation</a></li><li><a href="#2-rate-limit-mitigation" class="table-of-contents__link toc-highlight">2. Rate limit mitigation</a></li></ul></li><li><a href="#known-issues" class="table-of-contents__link toc-highlight">Known issues</a><ul><li><a href="#1-data-race-during-degraded-network-conditions" class="table-of-contents__link toc-highlight">1. Data race during degraded network conditions</a></li></ul></li><li><a href="#additional-examples" class="table-of-contents__link toc-highlight">Additional examples</a></li></ul></div></div></div></div></main></div></div><footer class="footer padding--none"><div class="container"><div class="row footer__links padding-vert--xl"><div class="col footer__col"><h4 class="footer__title">GET STARTED</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/comfyai_docs_build/basic-commands/basic/">Adding the bot</a></li><li class="footer__item"><a class="footer__link-item" href="/comfyai_docs_build/basic-commands/">Basic Usage</a></li><li class="footer__item"><a class="footer__link-item" href="/comfyai_docs_build/basic-commands/">Advanced Usage</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">COMMANDS</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/comfyai_docs_build/ai_tuning/">All Commands</a></li><li class="footer__item"><a class="footer__link-item" href="/comfyai_docs_build/ai_tuning/the-community/discord/">When Listeners</a></li><li class="footer__item"><a class="footer__link-item" href="/comfyai_docs_build/ai_tuning/the-community/discord/">Comfy Relay</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">GUIDES</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/comfyai_docs_build/guides/welcome/">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/comfyai_docs_build/guides/fundamentals/cryptography/">Growing your server</a></li><li class="footer__item"><a class="footer__link-item" href="/comfyai_docs_build/guides/fundamentals/cryptography/">Managing your Server</a></li><li class="footer__item"><a class="footer__link-item" href="/comfyai_docs_build/guides/tutorials/twitch/">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">COMMUNITY</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/JA25wHBxP3" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/comfyai" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.reddit.com/r/comfyai/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subreddit</a></li></ul></div></div><div class="footer__bottom padding-bottom--xl"><div><a href="https://cybermancy.org/comfyai" target="_blank" rel="noopener noreferrer"><img src="/comfyai_docs_build/img/logo.png" alt="ComfyAI Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/comfyai_docs_build/img/logo.png" alt="ComfyAI Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">© 2022 Cybermancy Computer Research.</div></div></div><div class="social"></div></footer></div>
<script src="/comfyai_docs_build/assets/js/runtime~main.2914dafe.js"></script>
<script src="/comfyai_docs_build/assets/js/main.be3323ff.js"></script>
</body>
</html>